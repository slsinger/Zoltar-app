
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zoltar the Snarky</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #output { margin-top: 2em; }
  </style>
</head>
<body>
  <h1>ðŸ”® Zoltar Awaits</h1>
  <button id="startButton">Tap to Awaken Zoltar</button>
  <p id="output">Zoltar is sleeping...</p>

  <script>
    const startButton = document.getElementById('startButton');
    const output = document.getElementById('output');

    const fortunes = [
      "You will find success... unless you donâ€™t.",
      "The stars say no. But try anyway.",
      "A mysterious figure will change your life. It might be your cat.",
      "You are destined for greatness, or at least mediocrity.",
      "Good news: you're not cursed. Probably.",
      "Todayâ€™s fortune: try turning it off and on again.",
      "You will soon achieve something minor, but satisfying.",
      "A dubious opportunity approaches. Take it. Or donâ€™t."
    ];
    
    let recognition = null;
    let stage = 'awaiting_trigger';
    let userName = '';
    let isSpeaking = false;

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  utter.voice = voices.find(v => v.name.includes("Samantha")) || voices[0];

  isSpeaking = true;
  output.textContent = "ðŸ—£ï¸ " + text;

  utter.onend = () => {
    console.log("ðŸ”Š Done speaking");
    isSpeaking = false;
    if (stage !== 'done') {
      setTimeout(startRecognition, 1000);
    }
  };

  speechSynthesis.speak(utter);
}

    function getRandomFortune() {
      return fortunes[Math.floor(Math.random() * fortunes.length)];
    }

    function handleSpeechResult(transcript) {
      const text = transcript.toLowerCase();
      output.textContent = `ðŸŽ§ Heard: ${text}`;

      if (stage === 'awaiting_trigger' && text.includes("zoltar")) {
        stage = 'awaiting_name';
        speak("I am Zoltar. What is your name?");
      } else if (stage === 'awaiting_name') {
        userName = transcript;
        stage = 'awaiting_confirmation';
        speak(`Hello ${userName}. Would you like to know your fortune?`);
      } else if (stage === 'awaiting_confirmation') {
        if (text.includes("yes")) {
          const fortune = getRandomFortune();
          speak(`${userName}, your fortune is: ${fortune}`);
          stage = 'done';
        } else {
          speak("Very well. Return when you seek truth.");
          stage = 'done';
        }
      }
    }

function startRecognition() {
  if (isSpeaking) {
    console.log("â³ Delaying recognition â€” still speaking");
    setTimeout(startRecognition, 500);
    return;
  }

  if (recognition) {
    recognition.abort(); // Clean up old instance
  }

  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onstart = () => {
    console.log("ðŸŽ™ï¸ Listening...");
    output.textContent = "ðŸŽ™ï¸ Zoltar is listening...";
  };

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript.trim();
    console.log("âœ… Heard: " + transcript);
    handleSpeechResult(transcript);
  };

  recognition.onerror = (event) => {
    console.error("âš ï¸ Speech recognition error:", event.error);
    output.textContent = "âš ï¸ Error: " + event.error;
    if (event.error !== "aborted") {
      setTimeout(startRecognition, 1500);
    }
  };

  recognition.onend = () => {
    if (!isSpeaking && stage !== 'done') {
      console.log("ðŸ” Restarting recognition after end");
      setTimeout(startRecognition, 1000);
    }
  };

  recognition.start();
}

    startButton.addEventListener('click', () => {
      speak("Greetings, mortal. Say 'Hello Zoltar' to begin.");
      startButton.style.display = 'none';
    });
  </script>
</body>
</html>
