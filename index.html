
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zoltar Speaks</title>
  <link rel="icon" href="icon.png" type="image/png">
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #000;
      color: #f4c842;
      text-align: center;
      padding: 2em;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 1em;
    }
    #fortune {
      font-size: 1.5em;
      margin-top: 2em;
      padding: 1em;
      border: 2px dashed #f4c842;
    }
    #startButton {
      margin-top: 2em;
      padding: 1em 2em;
      font-size: 1em;
      background-color: #f4c842;
      border: none;
      color: black;
      cursor: pointer;
      border-radius: 5px;
    }
    #debug {
      margin-top: 2em;
      color: #aaa;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Zoltar Knows All ðŸ”®</h1>
  <p>Say: <strong>"Hello Zoltar"</strong> to begin</p>
  <button id="startButton">ðŸ”Š Start Listening</button>
  <div id="fortune">...</div>
  <div id="debug"></div>

  <script>
    const fortunes = [
      "Your future looks brightâ€¦ unless you're driving without sunglasses again.",
      "Good news: Youâ€™re not a total disaster. Bad news: Youâ€™re still in charge of your life.",
      "You will soon receive clarityâ€¦ from someone else's bad example.",
      "You are special. Just like everyone else.",
      "Happiness is just around the corner. Unfortunately, your GPS is terrible.",
      "You will achieve greatness... through absolutely no effort of your own.",
      "Love is in the air. Or maybe thatâ€™s just pollen. Either way, youâ€™re sneezing.",
      "A great opportunity is headed your way â€” unless you keep scrolling.",
      "Beware of advice from talking robots.",
      "Your aura needs a tune-up. And probably a nap."
    ];

    let stage = 'idle';
    let userName = '';

    const synth = window.speechSynthesis;
    let selectedVoice = null;

    function speak(text) {
      if (!selectedVoice) {
        const voices = synth.getVoices();
        selectedVoice = voices.find(v => v.lang === 'en-US' && v.name.includes('Siri')) || voices[0];
      }

      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = selectedVoice;
      synth.speak(utter);
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    function startRecognition() {
      try {
        recognition.start();
        document.getElementById('debug').textContent = 'ðŸŽ™ Listening...';
      } catch (e) {
        document.getElementById('debug').textContent = 'Error starting recognition: ' + e.message;
      }
    }

   recognition.onresult = (event) => {
  const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
  updateDebug('Heard: ' + transcript);

  const greetings = ["hello", "hi", "hey", "zoltar"];

  if (stage === 'idle') {
    const foundGreeting = greetings.find(g => transcript.includes(g));
    if (foundGreeting) {
      speak("Greetings, seeker of wisdom. What is your name?");
      stage = 'awaiting_name';
    }
  } else if (stage === 'awaiting_name') {
    userName = transcript.split(" ").slice(-1)[0];
    speak(`Hello ${userName}. Would you like me to tell your fortune?`);
    stage = 'awaiting_yes';
  } else if (stage === 'awaiting_yes' && transcript.includes("yes")) {
    const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
    speak(fortune);
    document.getElementById("fortune").textContent = fortune;
    stage = 'idle';
  }

  updateDebug('Heard: ' + transcript);
  recognition.stop();
  setTimeout(() => recognition.start(), 500);
};


    recognition.onerror = (event) => {
      document.getElementById('debug').textContent = 'Error: ' + event.error;
    };

    window.onload = () => {
      synth.getVoices(); // preload voices
      document.getElementById("startButton").onclick = () => {
        document.getElementById("startButton").style.display = 'none';
        startRecognition();
      };
    };
  </script>
</body>
</html>
